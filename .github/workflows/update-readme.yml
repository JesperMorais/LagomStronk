name: Update README

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for update'
        required: false
        default: 'Manual trigger'

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Create branch
        run: |
          git checkout -b docs/update-readme-${{ github.run_number }}

      - name: Update README
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          use_commit_signing: false
          prompt: |
            Update README.md to reflect the current state of the codebase.

            Guidelines:
            - Keep it SHORT (under 50 lines)
            - Keep existing badges, update if needed
            - Update features list if new features were added
            - Update tech stack if dependencies changed
            - Do NOT add verbose explanations or tutorials
            - Do NOT add emojis
            - Maintain the current visual style

            Only make changes if something is actually outdated. If README is current, make no changes.

          claude_args: |
            --allowedTools "Read,Glob,Edit,Write"

      - name: Create PR
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add -A
          if git diff --staged --quiet; then
            echo "No changes to commit"
            exit 0
          fi
          git commit -m "docs: Update README"
          git push -u origin docs/update-readme-${{ github.run_number }}
          gh pr create --title "docs: Update README" --body "Automated README update triggered by: ${{ github.event.inputs.reason }}" --base main
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
