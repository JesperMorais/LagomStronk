---
phase: 02-ux-overhaul-exercise-system
plan: 07
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - js/ui/components/filterDrawer.js
  - js/ui/components/exerciseCard.js
  - css/library.css
  - js/app.js
  - index.html
autonomous: true

must_haves:
  truths:
    - "User can filter exercises by muscle group"
    - "User can filter exercises by equipment type"
    - "User can switch between list and grid view"
    - "User can search exercises by name"
    - "User can favorite exercises"
    - "User sees recently used exercises for quick access"
  artifacts:
    - path: "js/ui/components/filterDrawer.js"
      provides: "Exercise filter drawer with chips"
      exports: ["FilterDrawer", "openFilterDrawer", "closeFilterDrawer"]
    - path: "js/ui/components/exerciseCard.js"
      provides: "Exercise card component with metadata display"
      exports: ["renderExerciseCard", "renderExerciseList", "renderExerciseGrid"]
    - path: "css/library.css"
      provides: "Exercise library styling"
  key_links:
    - from: "js/ui/components/filterDrawer.js"
      to: "js/data/exercises.js"
      via: "import for filter options"
      pattern: "import.*exercises"
    - from: "js/app.js"
      to: "js/ui/components/filterDrawer.js"
      via: "import for library view"
      pattern: "import.*filterDrawer"
---

<objective>
Create exercise library UI with filtering, search, list/grid toggle, favorites, and recently used exercises.

Purpose: Implements EXER-01 through EXER-07 (filter, exercise cards, library view, favorites, recently used). This transforms the basic exercise list into a comprehensive, searchable library.

Output: Filter drawer, exercise cards, library CSS, integrated into app.
</objective>

<execution_context>
@/home/david/.claude/get-shit-done/workflows/execute-plan.md
@/home/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ux-overhaul-exercise-system/02-CONTEXT.md
@.planning/phases/02-ux-overhaul-exercise-system/02-RESEARCH.md
@.planning/phases/02-ux-overhaul-exercise-system/02-01-SUMMARY.md
@js/app.js
@js/data/exercises.js
@css/style.css
@/home/david/Dev/personal/color-palette.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filter drawer component</name>
  <files>js/ui/components/filterDrawer.js</files>
  <action>
Create `js/ui/components/filterDrawer.js` following RESEARCH.md patterns:

```javascript
import { MUSCLE_GROUPS, EQUIPMENT_TYPES } from '../../data/exercises.js';

export class FilterDrawer {
  constructor(options = {}) {
    this.onApply = options.onApply || (() => {});
    this.onClear = options.onClear || (() => {});
    this.isOpen = false;
    this.selectedMuscles = new Set();
    this.selectedEquipment = new Set();
    this.element = null;

    this.render();
  }

  render() {
    const muscleChips = Object.keys(MUSCLE_GROUPS).map(group => `
      <button class="filter-chip" data-type="muscle" data-value="${group}">${group}</button>
    `).join('');

    const equipmentChips = EQUIPMENT_TYPES.map(type => `
      <button class="filter-chip" data-type="equipment" data-value="${type}">${type}</button>
    `).join('');

    const html = `
      <div class="filter-drawer" id="filter-drawer">
        <div class="filter-overlay" id="filter-overlay"></div>
        <div class="filter-panel">
          <div class="filter-header">
            <h3>Filter Exercises</h3>
            <button class="filter-close" id="filter-close">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>

          <div class="filter-content">
            <div class="filter-section">
              <h4>Muscle Groups</h4>
              <div class="filter-chips" id="muscle-filters">
                ${muscleChips}
              </div>
            </div>

            <div class="filter-section">
              <h4>Equipment</h4>
              <div class="filter-chips" id="equipment-filters">
                ${equipmentChips}
              </div>
            </div>
          </div>

          <div class="filter-footer">
            <button class="btn btn-secondary" id="filter-clear">Clear All</button>
            <button class="btn btn-primary" id="filter-apply">
              Apply Filters
              <span class="filter-count" id="filter-count"></span>
            </button>
          </div>
        </div>
      </div>
    `;

    document.body.insertAdjacentHTML('beforeend', html);
    this.element = document.getElementById('filter-drawer');
    this.attachEvents();
  }

  attachEvents() {
    // Overlay click to close
    document.getElementById('filter-overlay').addEventListener('click', () => this.close());
    document.getElementById('filter-close').addEventListener('click', () => this.close());

    // Chip toggles
    this.element.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        const type = chip.dataset.type;
        const value = chip.dataset.value;
        const set = type === 'muscle' ? this.selectedMuscles : this.selectedEquipment;

        if (set.has(value)) {
          set.delete(value);
          chip.classList.remove('active');
        } else {
          set.add(value);
          chip.classList.add('active');
        }

        this.updateCount();
      });
    });

    // Clear button
    document.getElementById('filter-clear').addEventListener('click', () => {
      this.clear();
    });

    // Apply button
    document.getElementById('filter-apply').addEventListener('click', () => {
      this.apply();
    });
  }

  open() {
    this.isOpen = true;
    this.element.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  close() {
    this.isOpen = false;
    this.element.classList.remove('active');
    document.body.style.overflow = '';
  }

  clear() {
    this.selectedMuscles.clear();
    this.selectedEquipment.clear();
    this.element.querySelectorAll('.filter-chip').forEach(chip => {
      chip.classList.remove('active');
    });
    this.updateCount();
    this.onClear();
  }

  apply() {
    this.onApply({
      muscleGroups: Array.from(this.selectedMuscles),
      equipment: Array.from(this.selectedEquipment)
    });
    this.close();
  }

  updateCount() {
    const total = this.selectedMuscles.size + this.selectedEquipment.size;
    const countEl = document.getElementById('filter-count');
    countEl.textContent = total > 0 ? `(${total})` : '';
  }

  getFilters() {
    return {
      muscleGroups: Array.from(this.selectedMuscles),
      equipment: Array.from(this.selectedEquipment)
    };
  }

  hasActiveFilters() {
    return this.selectedMuscles.size > 0 || this.selectedEquipment.size > 0;
  }
}

// Singleton and convenience functions
let filterDrawer = null;

export function initFilterDrawer(options) {
  if (filterDrawer) filterDrawer.element?.remove();
  filterDrawer = new FilterDrawer(options);
  return filterDrawer;
}

export function openFilterDrawer() {
  filterDrawer?.open();
}

export function closeFilterDrawer() {
  filterDrawer?.close();
}

export function getFilterDrawer() {
  return filterDrawer;
}
```
  </action>
  <verify>
File exists. In browser console:
`import('./js/ui/components/filterDrawer.js').then(m => { m.initFilterDrawer({ onApply: console.log }); m.openFilterDrawer(); })`
  </verify>
  <done>
- FilterDrawer class with chip-based selection
- Open/close with overlay
- Clear and Apply buttons
- Count badge shows active filters
- Callbacks for onApply and onClear
  </done>
</task>

<task type="auto">
  <name>Task 2: Create exercise card component and library CSS</name>
  <files>js/ui/components/exerciseCard.js, css/library.css, index.html</files>
  <action>
**1. Create js/ui/components/exerciseCard.js:**

```javascript
import { EXERCISES, getExerciseMetadata } from '../../data/exercises.js';

export function renderExerciseCard(exercise, options = {}) {
  const { isFavorite = false, isCustom = false, onClick, onFavorite } = options;
  const metadata = typeof exercise === 'string'
    ? getExerciseMetadata(exercise)
    : exercise;
  const name = typeof exercise === 'string' ? exercise : exercise.name;

  return `
    <div class="exercise-card-item ${isCustom ? 'custom' : ''}"
         data-exercise="${name}"
         ${onClick ? `onclick="${onClick}"` : ''}>
      <div class="exercise-card-image">
        <!-- Placeholder for muscle highlight image -->
        <div class="exercise-placeholder-image">
          <span class="placeholder-muscle">${metadata.primaryMuscles[0]?.charAt(0) || '?'}</span>
        </div>
      </div>
      <div class="exercise-card-content">
        <div class="exercise-card-name">${name}</div>
        <div class="exercise-card-meta">
          <span class="meta-muscle">${metadata.primaryMuscles.join(', ')}</span>
          <span class="meta-equipment">${metadata.equipment}</span>
        </div>
      </div>
      <button class="exercise-card-favorite ${isFavorite ? 'active' : ''}"
              onclick="event.stopPropagation(); handleFavoriteToggle('${name}')">
        ${isFavorite ? '‚òÖ' : '‚òÜ'}
      </button>
      ${isCustom ? '<span class="custom-badge">üë§</span>' : ''}
    </div>
  `;
}

export function renderExerciseList(exercises, favorites = [], customExercises = {}, onSelect) {
  if (exercises.length === 0) {
    return `
      <div class="empty-state">
        <div class="empty-state-icon">üîç</div>
        <p>No exercises found.</p>
        <p>Try adjusting your filters.</p>
      </div>
    `;
  }

  return `
    <div class="exercise-list-view">
      ${exercises.map(name => renderExerciseCard(name, {
        isFavorite: favorites.includes(name),
        isCustom: !!customExercises[name],
        onClick: onSelect ? `${onSelect}('${name}')` : null
      })).join('')}
    </div>
  `;
}

export function renderExerciseGrid(exercises, favorites = [], customExercises = {}, onSelect) {
  if (exercises.length === 0) {
    return `
      <div class="empty-state">
        <div class="empty-state-icon">üîç</div>
        <p>No exercises found.</p>
      </div>
    `;
  }

  return `
    <div class="exercise-grid-view">
      ${exercises.map(name => {
        const metadata = getExerciseMetadata(name) || {};
        const isFavorite = favorites.includes(name);
        const isCustom = !!customExercises[name];

        return `
          <div class="exercise-grid-card ${isCustom ? 'custom' : ''}"
               data-exercise="${name}"
               ${onSelect ? `onclick="${onSelect}('${name}')"` : ''}>
            <div class="grid-card-image">
              <div class="exercise-placeholder-image">
                <span class="placeholder-muscle">${metadata.primaryMuscles?.[0]?.charAt(0) || '?'}</span>
              </div>
            </div>
            <div class="grid-card-name">${name}</div>
            <button class="grid-card-favorite ${isFavorite ? 'active' : ''}"
                    onclick="event.stopPropagation(); handleFavoriteToggle('${name}')">
              ${isFavorite ? '‚òÖ' : '‚òÜ'}
            </button>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

export function renderRecentExercises(recentNames, onSelect) {
  if (recentNames.length === 0) return '';

  return `
    <div class="recent-exercises">
      <h4 class="recent-title">Recently Used</h4>
      <div class="recent-chips">
        ${recentNames.map(name => `
          <button class="recent-chip" onclick="${onSelect}('${name}')">${name}</button>
        `).join('')}
      </div>
    </div>
  `;
}
```

**2. Create css/library.css:**

```css
/* Library Header with Search and Controls */
.library-header {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
}

.library-search {
  position: relative;
}

.library-search-input {
  width: 100%;
  padding: var(--spacing-sm) var(--spacing-md);
  padding-left: 40px;
  background: rgba(35, 44, 51, 0.6);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-size: 1rem;
}

.library-search-input:focus {
  outline: none;
  border-color: var(--border-mint);
}

.library-search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-tertiary);
}

.library-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.library-view-toggle {
  display: flex;
  gap: 4px;
  background: rgba(255, 255, 255, 0.05);
  padding: 4px;
  border-radius: var(--radius);
}

.library-filter-btn {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  color: var(--text-secondary);
  cursor: pointer;
}

.library-filter-btn.has-filters {
  border-color: var(--mint);
  color: var(--mint);
}

/* Exercise List View */
.exercise-list-view {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.exercise-card-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: rgba(35, 44, 51, 0.6);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
}

.exercise-card-item:hover {
  border-color: var(--border-mint);
}

.exercise-card-image {
  width: 48px;
  height: 48px;
  border-radius: var(--radius);
  overflow: hidden;
  flex-shrink: 0;
}

.exercise-placeholder-image {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(209, 255, 198, 0.2), rgba(129, 140, 248, 0.2));
  display: flex;
  align-items: center;
  justify-content: center;
}

.placeholder-muscle {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--mint);
}

.exercise-card-content {
  flex: 1;
  min-width: 0;
}

.exercise-card-name {
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.exercise-card-meta {
  display: flex;
  gap: var(--spacing-sm);
  font-size: 0.75rem;
  color: var(--text-tertiary);
}

.exercise-card-favorite {
  background: none;
  border: none;
  font-size: 1.25rem;
  color: var(--text-tertiary);
  cursor: pointer;
  padding: var(--spacing-xs);
}

.exercise-card-favorite.active {
  color: var(--amber);
}

.custom-badge {
  font-size: 0.75rem;
  opacity: 0.6;
}

/* Exercise Grid View */
.exercise-grid-view {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-sm);
}

.exercise-grid-card {
  background: rgba(35, 44, 51, 0.6);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: var(--spacing-sm);
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.exercise-grid-card:hover {
  border-color: var(--border-mint);
}

.grid-card-image {
  aspect-ratio: 1;
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: var(--spacing-xs);
}

.grid-card-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.grid-card-favorite {
  position: absolute;
  top: var(--spacing-xs);
  right: var(--spacing-xs);
  background: rgba(0, 0, 0, 0.5);
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
  color: var(--text-tertiary);
  cursor: pointer;
}

.grid-card-favorite.active {
  color: var(--amber);
}

/* Recent Exercises */
.recent-exercises {
  margin-bottom: var(--spacing-md);
}

.recent-title {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-bottom: var(--spacing-xs);
}

.recent-chips {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);
}

.recent-chip {
  padding: var(--spacing-xs) var(--spacing-sm);
  background: rgba(209, 255, 198, 0.1);
  border: 1px solid var(--border-mint);
  border-radius: 20px;
  color: var(--mint);
  font-size: 0.75rem;
  cursor: pointer;
}

.recent-chip:hover {
  background: rgba(209, 255, 198, 0.2);
}

/* Filter Drawer */
.filter-drawer {
  position: fixed;
  inset: 0;
  z-index: 1000;
  pointer-events: none;
}

.filter-drawer.active {
  pointer-events: auto;
}

.filter-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  opacity: 0;
  transition: opacity 0.3s;
}

.filter-drawer.active .filter-overlay {
  opacity: 1;
}

.filter-panel {
  position: absolute;
  right: 0;
  top: 0;
  bottom: 0;
  width: 85%;
  max-width: 400px;
  background: var(--card-background);
  transform: translateX(100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  flex-direction: column;
}

.filter-drawer.active .filter-panel {
  transform: translateX(0);
}

.filter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--border-color);
}

.filter-header h3 {
  font-size: 1.125rem;
  color: var(--mint);
}

.filter-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: var(--spacing-xs);
}

.filter-content {
  flex: 1;
  overflow-y: auto;
  padding: var(--spacing-md);
}

.filter-section {
  margin-bottom: var(--spacing-lg);
}

.filter-section h4 {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-bottom: var(--spacing-sm);
}

.filter-chips {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);
}

.filter-chip {
  padding: var(--spacing-xs) var(--spacing-sm);
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  color: var(--text-secondary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s;
}

.filter-chip:hover {
  border-color: var(--border-mint);
}

.filter-chip.active {
  background: rgba(209, 255, 198, 0.2);
  border-color: var(--mint);
  color: var(--mint);
}

.filter-footer {
  display: flex;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  border-top: 1px solid var(--border-color);
}

.filter-footer .btn {
  flex: 1;
}

.filter-count {
  margin-left: var(--spacing-xs);
}
```

**3. Update index.html:**
```html
<link rel="stylesheet" href="css/library.css">
```
  </action>
  <verify>
- css/library.css exists
- js/ui/components/exerciseCard.js exists
- index.html includes library.css
  </verify>
  <done>
- Exercise card component with list and grid variants
- Filter drawer with chip-based selection
- Recent exercises chips section
- Search input with icon
- View toggle between list/grid
- Favorite star button on cards
- Custom exercise indicator (user icon)
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate library UI into app</name>
  <files>js/app.js, index.html</files>
  <action>
**1. Update index.html #library-view:**

```html
<section id="library-view" class="view">
  <div class="view-header">
    <h2>Exercise Library</h2>
  </div>

  <div class="library-header">
    <div class="library-search">
      <svg class="library-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
      <input type="text" class="library-search-input" placeholder="Search exercises..." id="library-search">
    </div>

    <div class="library-controls">
      <button class="library-filter-btn" id="open-filter-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
        </svg>
        <span>Filter</span>
      </button>

      <div class="library-view-toggle">
        <button class="toggle-btn active" id="library-list-btn" data-view="list">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
          </svg>
        </button>
        <button class="toggle-btn" id="library-grid-btn" data-view="grid">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div id="recent-exercises"></div>
  <div id="exercise-library-list" class="library-list"></div>

  <div class="library-actions">
    <button class="btn btn-secondary" id="add-custom-exercise-btn">
      + Add Custom Exercise
    </button>
  </div>
</section>
```

**2. Update js/app.js:**

Add imports:
```javascript
import { filterExercises, searchExercises, getRecentExercises, EXERCISES } from './data/exercises.js';
import { initFilterDrawer, openFilterDrawer, getFilterDrawer } from './ui/components/filterDrawer.js';
import { renderExerciseList, renderExerciseGrid, renderRecentExercises } from './ui/components/exerciseCard.js';
```

Add state:
```javascript
let libraryViewMode = 'list'; // 'list' or 'grid'
let librarySearchQuery = '';
let libraryFilters = { muscleGroups: [], equipment: [] };
```

Update renderLibraryView:
```javascript
function renderLibraryView() {
  // Initialize filter drawer if needed
  if (!getFilterDrawer()) {
    initFilterDrawer({
      onApply: (filters) => {
        libraryFilters = filters;
        updateFilterButton();
        renderLibraryExercises();
      },
      onClear: () => {
        libraryFilters = { muscleGroups: [], equipment: [] };
        updateFilterButton();
        renderLibraryExercises();
      }
    });
  }

  // Render recent exercises
  const recentContainer = document.getElementById('recent-exercises');
  const recentNames = getRecentExercises(appData.workouts, 5);
  recentContainer.innerHTML = renderRecentExercises(recentNames, 'selectLibraryExercise');

  renderLibraryExercises();
}

function renderLibraryExercises() {
  let exercises = [...appData.exerciseLibrary];

  // Apply search
  if (librarySearchQuery) {
    exercises = searchExercises(exercises, librarySearchQuery);
  }

  // Apply filters
  if (libraryFilters.muscleGroups.length > 0 || libraryFilters.equipment.length > 0) {
    exercises = filterExercises(exercises, libraryFilters);
  }

  const container = document.getElementById('exercise-library-list');

  if (libraryViewMode === 'list') {
    container.innerHTML = renderExerciseList(
      exercises,
      appData.favorites || [],
      appData.customExercises || {},
      'selectLibraryExercise'
    );
  } else {
    container.innerHTML = renderExerciseGrid(
      exercises,
      appData.favorites || [],
      appData.customExercises || {},
      'selectLibraryExercise'
    );
  }
}

function updateFilterButton() {
  const btn = document.getElementById('open-filter-btn');
  const hasFilters = libraryFilters.muscleGroups.length > 0 || libraryFilters.equipment.length > 0;
  btn.classList.toggle('has-filters', hasFilters);
}
```

Add event listeners in setupEventListeners:
```javascript
// Library search
document.getElementById('library-search')?.addEventListener('input', (e) => {
  librarySearchQuery = e.target.value;
  renderLibraryExercises();
});

// Filter button
document.getElementById('open-filter-btn')?.addEventListener('click', openFilterDrawer);

// View toggle
document.getElementById('library-list-btn')?.addEventListener('click', () => {
  libraryViewMode = 'list';
  updateLibraryToggle();
  renderLibraryExercises();
});

document.getElementById('library-grid-btn')?.addEventListener('click', () => {
  libraryViewMode = 'grid';
  updateLibraryToggle();
  renderLibraryExercises();
});

function updateLibraryToggle() {
  document.getElementById('library-list-btn').classList.toggle('active', libraryViewMode === 'list');
  document.getElementById('library-grid-btn').classList.toggle('active', libraryViewMode === 'grid');
}
```

Add global handlers:
```javascript
window.selectLibraryExercise = function(exerciseName) {
  // Show exercise detail or add to workout
  console.log('Selected:', exerciseName);
  // Could open exercise detail modal or start adding to workout
};

window.handleFavoriteToggle = async function(exerciseName) {
  appData = await toggleFavoriteExercise(appData, exerciseName);
  renderLibraryExercises();
};
```

Import toggleFavoriteExercise from data.js.
  </action>
  <verify>
1. Open app, go to Library view
2. Search box filters exercises as you type
3. Filter button opens drawer
4. Select filters, Apply - list updates
5. Toggle between list and grid view
6. Recently used exercises show at top
7. Tap star to favorite an exercise
  </verify>
  <done>
- Search filters exercises in real-time
- Filter drawer opens with muscle/equipment chips
- List/grid toggle works
- Recently used exercises show as chips
- Favorite toggle persists to storage
- Filter button shows indicator when filters active
  </done>
</task>

</tasks>

<verification>
1. Search: Type in search - exercises filter immediately
2. Filter: Open drawer, select muscle groups - apply - list shows filtered
3. Clear: Clear filters - all exercises show
4. Toggle: Switch between list and grid - same exercises shown
5. Recent: Recently used exercises appear as chips above list
6. Favorites: Tap star - turns amber, persists after navigation
7. Empty: Apply impossible filter combo - empty state shows
</verification>

<success_criteria>
- Search filters by exercise name (case-insensitive)
- Filter drawer shows all muscle groups and equipment types
- Multiple filters can be selected (OR within type, AND between types)
- List view shows exercise with metadata
- Grid view shows 2-column card layout
- Recently used exercises from last 5 workouts shown
- Favorites persist to storage
- Filter button indicates when filters active
</success_criteria>

<output>
After completion, create `.planning/phases/02-ux-overhaul-exercise-system/02-07-SUMMARY.md`
</output>
