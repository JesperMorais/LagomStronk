---
phase: 02-ux-overhaul-exercise-system
plan: 03
type: execute
wave: 2
depends_on: ["02-02"]
files_modified:
  - js/ui/dashboard/volumeChart.js
  - js/ui/dashboard/prCards.js
  - css/dashboard.css
  - js/app.js
autonomous: true

must_haves:
  truths:
    - "User sees weekly volume chart with gradient bars"
    - "User sees goal line overlay on volume chart"
    - "User sees recent PRs as horizontal scrollable cards"
    - "Volume chart is visually stunning with mint gradients"
  artifacts:
    - path: "js/ui/dashboard/volumeChart.js"
      provides: "Chart.js volume visualization with gradients"
      exports: ["createVolumeChart", "updateVolumeChart"]
    - path: "js/ui/dashboard/prCards.js"
      provides: "Horizontal scrollable PR cards"
      exports: ["renderPRCards"]
  key_links:
    - from: "js/ui/dashboard/volumeChart.js"
      to: "chart.js"
      via: "CDN script"
      pattern: "new Chart"
    - from: "js/app.js"
      to: "js/ui/dashboard/volumeChart.js"
      via: "import for dashboard render"
      pattern: "import.*volumeChart"
---

<objective>
Create stunning volume chart with gradient bars and horizontal scrollable PR cards for the dashboard.

Purpose: Implements UX-03 (weekly volume chart) and UX-05 (recent PRs). These are the data visualization components that give users insight into their progress at a glance.

Output: Volume chart module with Chart.js gradients, PR cards component, updated dashboard CSS.
</objective>

<execution_context>
@/home/david/.claude/get-shit-done/workflows/execute-plan.md
@/home/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ux-overhaul-exercise-system/02-CONTEXT.md
@.planning/phases/02-ux-overhaul-exercise-system/02-RESEARCH.md
@.planning/phases/02-ux-overhaul-exercise-system/02-02-SUMMARY.md
@js/charts.js
@css/dashboard.css
@/home/david/Dev/personal/color-palette.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create volume chart module with gradients</name>
  <files>js/ui/dashboard/volumeChart.js</files>
  <action>
Create `js/ui/dashboard/volumeChart.js` with stunning Chart.js visualization:

**1. getWeeklyVolume(workouts) helper:**
- Returns array of 7 days (Mon-Sun) with daily volume totals
- Uses current week, fills 0 for days with no workout

**2. createVolumeChart(canvasId, weekData, goalVolume = 3000):**
Following the research pattern from 02-RESEARCH.md:

```javascript
export function createVolumeChart(canvasId, weekData, goalVolume = 3000) {
  const ctx = document.getElementById(canvasId).getContext('2d');

  // Create gradient ONCE - reuse reference (per Pitfall 1 in RESEARCH.md)
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);
  gradient.addColorStop(0, 'rgba(209, 255, 198, 0.8)');  // mint
  gradient.addColorStop(1, 'rgba(209, 255, 198, 0.2)');  // mint-transparent

  return new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      datasets: [{
        label: 'Volume',
        data: weekData,
        backgroundColor: gradient,
        borderRadius: 8,
        borderSkipped: false,
        barThickness: 32
      }, {
        type: 'line',
        label: 'Goal',
        data: Array(7).fill(goalVolume),
        borderColor: '#fbbf24',  // amber
        borderWidth: 2,
        borderDash: [5, 5],
        pointRadius: 0,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        mode: 'index',
        intersect: false
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(35, 44, 51, 0.95)',
          titleColor: '#ffffff',
          bodyColor: '#e5e7eb',
          borderColor: 'rgba(209, 255, 198, 0.3)',
          borderWidth: 1,
          padding: 12,
          displayColors: false,
          callbacks: {
            label: (context) => {
              if (context.dataset.label === 'Goal') {
                return `Goal: ${context.parsed.y.toLocaleString()}kg`;
              }
              return `Volume: ${context.parsed.y.toLocaleString()}kg`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.1)',
            drawBorder: false
          },
          ticks: {
            color: '#9ca3af',
            callback: (value) => value >= 1000 ? `${value/1000}k` : value
          }
        },
        x: {
          grid: { display: false },
          ticks: { color: '#9ca3af' }
        }
      }
    }
  });
}
```

**3. updateVolumeChart(chart, newData):**
- Updates existing chart data without recreating gradient
- Uses `chart.update('none')` for performance (skip animation on updates)

**4. renderDashboardVolumeChart(container, workouts):**
- Creates the canvas element
- Calculates weekly volume
- Initializes chart
- Returns chart instance for later updates

**Important:** Chart.js is already loaded via CDN in index.html. Don't import it.
  </action>
  <verify>
File exists. In browser console after app loads:
`import('./js/ui/dashboard/volumeChart.js').then(m => console.log(typeof m.createVolumeChart))`
  </verify>
  <done>
- Volume chart uses mint gradient (not solid color)
- Goal line shows as amber dashed line
- Bar corners are rounded (borderRadius: 8)
- Tooltips styled to match app theme
- Y-axis shows k suffix for thousands
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PR cards component</name>
  <files>js/ui/dashboard/prCards.js</files>
  <action>
Create `js/ui/dashboard/prCards.js` with horizontal scrollable PR cards:

**1. getRecentPRs(workouts, limit = 5):**
- Analyze workouts to find PRs
- Return array of { exercise, type, value, date, previousValue }
- Type can be: 'weight', 'volume', '1rm'
- Sort by date (most recent first)

**2. renderPRCards(container, workouts):**
```javascript
export function renderPRCards(container, workouts) {
  const prs = getRecentPRs(workouts, 5);

  if (prs.length === 0) {
    container.innerHTML = `
      <div class="pr-cards-empty">
        <span class="pr-empty-icon">üèÜ</span>
        <span class="pr-empty-text">Hit PRs to see them here!</span>
      </div>
    `;
    return;
  }

  container.innerHTML = `
    <div class="pr-cards-header">
      <h3 class="pr-cards-title">Recent PRs</h3>
    </div>
    <div class="pr-cards-scroll">
      ${prs.map(pr => `
        <div class="pr-card">
          <div class="pr-card-badge">${getPRTypeIcon(pr.type)}</div>
          <div class="pr-card-exercise">${pr.exercise}</div>
          <div class="pr-card-value">${formatPRValue(pr.value, pr.type)}</div>
          <div class="pr-card-date">${formatRelativeDate(pr.date)}</div>
        </div>
      `).join('')}
    </div>
  `;
}
```

**3. Helper functions:**
- `getPRTypeIcon(type)` - Returns 'üí™' for weight, 'üìä' for volume, 'üéØ' for 1rm
- `formatPRValue(value, type)` - Returns "100kg" for weight, "2.5k kg" for volume
- `formatRelativeDate(date)` - Returns "Today", "Yesterday", "3d ago", etc.

**Scrolling behavior:**
- Horizontal scroll with overflow-x: auto
- Hide scrollbar on desktop, show thin scrollbar on mobile
- Snap to card edges (scroll-snap)
  </action>
  <verify>
File exists. In browser console:
`import('./js/ui/dashboard/prCards.js').then(m => console.log(typeof m.renderPRCards))`
  </verify>
  <done>
- PR cards scroll horizontally
- Each card shows exercise name, PR type icon, value, relative date
- Empty state shows encouraging message
- Cards snap during scroll
  </done>
</task>

<task type="auto">
  <name>Task 3: Add dashboard CSS and integrate</name>
  <files>css/dashboard.css, js/app.js</files>
  <action>
**1. Add to css/dashboard.css:**

```css
/* Volume Chart Section */
.dashboard-volume {
  background: rgba(35, 44, 51, 0.6);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.volume-chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
}

.volume-chart-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.volume-chart-toggle {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  background: none;
  border: 1px solid var(--border-color);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius);
  cursor: pointer;
}

.volume-chart-container {
  height: 200px;
  position: relative;
}

/* PR Cards Section */
.dashboard-prs {
  margin-bottom: var(--spacing-lg);
}

.pr-cards-header {
  margin-bottom: var(--spacing-sm);
}

.pr-cards-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.pr-cards-scroll {
  display: flex;
  gap: var(--spacing-sm);
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scrollbar-width: none;  /* Firefox */
  -ms-overflow-style: none;  /* IE/Edge */
  padding-bottom: var(--spacing-xs);
}

.pr-cards-scroll::-webkit-scrollbar {
  display: none;  /* Chrome/Safari */
}

.pr-card {
  flex-shrink: 0;
  width: 140px;
  background: rgba(35, 44, 51, 0.8);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  scroll-snap-align: start;
  transition: border-color 0.2s, transform 0.2s;
}

.pr-card:hover {
  border-color: var(--border-mint);
  transform: translateY(-2px);
}

.pr-card-badge {
  font-size: 1.5rem;
  margin-bottom: var(--spacing-xs);
}

.pr-card-exercise {
  font-size: 0.75rem;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: var(--spacing-xs);
}

.pr-card-value {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--mint);
}

.pr-card-date {
  font-size: 0.625rem;
  color: var(--text-tertiary);
  margin-top: var(--spacing-xs);
}

/* PR Cards Empty State */
.pr-cards-empty {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: rgba(35, 44, 51, 0.4);
  border: 1px dashed var(--border-color);
  border-radius: var(--radius);
  color: var(--text-tertiary);
}

.pr-empty-icon {
  font-size: 1.5rem;
}

.pr-empty-text {
  font-size: 0.875rem;
}
```

**2. Update js/app.js to integrate dashboard:**

Add imports:
```javascript
import { renderHero } from './ui/dashboard/hero.js';
import { renderDashboardVolumeChart } from './ui/dashboard/volumeChart.js';
import { renderPRCards } from './ui/dashboard/prCards.js';
```

Update renderTodayView():
```javascript
function renderTodayView() {
  // Render dashboard components
  const heroContainer = document.getElementById('dashboard-hero');
  if (heroContainer) {
    renderHero(heroContainer, appData);
  }

  const volumeContainer = document.getElementById('dashboard-volume');
  if (volumeContainer) {
    renderDashboardVolumeChart(volumeContainer, appData.workouts);
  }

  const prContainer = document.getElementById('dashboard-prs');
  if (prContainer) {
    renderPRCards(prContainer, appData.workouts);
  }

  // Existing workout rendering...
  const workout = getWorkoutByDate(appData, currentDate);
  // ... rest of existing code
}
```

**3. Update index.html (if not done in 02-02):**
Add containers in #today-view:
```html
<div id="dashboard-hero"></div>
<div id="dashboard-volume" class="dashboard-volume">
  <div class="volume-chart-header">
    <h3 class="volume-chart-title">This Week</h3>
  </div>
  <div class="volume-chart-container">
    <canvas id="dashboard-volume-chart"></canvas>
  </div>
</div>
<div id="dashboard-prs" class="dashboard-prs"></div>
```
  </action>
  <verify>
1. Open app, Today view shows volume chart with gradient bars
2. PR cards section shows (with empty state if no PRs)
3. Volume chart tooltip shows on hover
4. PR cards scroll horizontally on touch/drag
  </verify>
  <done>
- Volume chart displays with mint gradient bars
- Goal line shows as amber dashed line
- PR cards scroll horizontally with snap
- Empty states show for both components
- Integrated into app.js renderTodayView
  </done>
</task>

</tasks>

<verification>
1. Chart renders: Open app, see volume chart with bars
2. Gradient visible: Bars should fade from solid mint at top to transparent at bottom
3. Goal line: Amber dashed line visible across chart
4. PR cards: Scroll section visible below chart
5. Hover effects: PR cards lift slightly on hover
6. Mobile scroll: On touch device, PR cards snap while scrolling
</verification>

<success_criteria>
- Volume chart uses Chart.js with gradient fill
- Goal line is amber dashed at configurable value
- PR cards display exercise, value, relative date
- Horizontal scroll works with snap points
- Empty states show for no data
- Colors match color-palette.md
- Tooltip styling matches app theme
</success_criteria>

<output>
After completion, create `.planning/phases/02-ux-overhaul-exercise-system/02-03-SUMMARY.md`
</output>
