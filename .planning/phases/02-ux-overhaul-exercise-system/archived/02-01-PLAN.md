---
phase: 02-ux-overhaul-exercise-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/data/exercises.js
  - js/data.js
autonomous: true

must_haves:
  truths:
    - "Exercise data includes muscle group and equipment metadata"
    - "Exercises can be filtered by muscle group"
    - "Exercises can be filtered by equipment type"
    - "Exercises have primary and secondary muscle targets"
    - "Custom exercises can store user-defined metadata"
  artifacts:
    - path: "js/data/exercises.js"
      provides: "Exercise database with metadata, filter/search utilities"
      exports: ["EXERCISES", "MUSCLE_GROUPS", "EQUIPMENT_TYPES", "filterExercises", "searchExercises", "getRecentExercises", "toggleFavorite"]
  key_links:
    - from: "js/data/exercises.js"
      to: "js/data.js"
      via: "import for exercise operations"
      pattern: "import.*exercises"
---

<objective>
Create enhanced exercise data model with muscle group and equipment metadata, plus filtering and search utilities.

Purpose: Foundation for exercise library filtering (EXER-01, EXER-02), custom exercise creation (EXER-04), and recently used exercises (EXER-06). All subsequent exercise-related plans depend on this data model.

Output: js/data/exercises.js with complete exercise database, metadata constants, and utility functions.
</objective>

<execution_context>
@/home/david/.claude/get-shit-done/workflows/execute-plan.md
@/home/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ux-overhaul-exercise-system/02-CONTEXT.md
@.planning/phases/02-ux-overhaul-exercise-system/02-RESEARCH.md
@js/data.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create exercise data module with metadata</name>
  <files>js/data/exercises.js</files>
  <action>
Create a new module `js/data/exercises.js` with:

**1. Muscle group constants (MUSCLE_GROUPS):**
Primary groups with sub-groups for detailed tracking:
- Chest: Upper Chest, Middle Chest, Lower Chest
- Back: Lats, Upper Back, Lower Back, Rhomboids
- Shoulders: Front Delts, Side Delts, Rear Delts
- Legs: Quads, Hamstrings, Glutes, Calves, Hip Flexors
- Arms: Biceps (Long Head, Short Head), Triceps (Long Head, Lateral Head, Medial Head), Forearms
- Core: Abs, Obliques, Lower Back
- Other: Neck, Traps

**2. Equipment type constants (EQUIPMENT_TYPES):**
- Barbell
- Dumbbell
- EZ Bar
- Machine
- Cable
- Smith Machine
- Kettlebell
- Resistance Band
- Bodyweight
- Other

**3. EXERCISES database object:**
Export an object mapping exercise names to metadata:
```javascript
export const EXERCISES = {
  'Bench Press': {
    primaryMuscles: ['Chest'],
    secondaryMuscles: ['Triceps', 'Front Delts'],
    equipment: 'Barbell',
    isDefault: true
  },
  // ... all DEFAULT_EXERCISES from data.js with proper metadata
};
```

Include all 28 default exercises from data.js with appropriate muscle/equipment mappings.

**4. Utility functions:**
- `getExerciseMetadata(name)` - Returns metadata for an exercise (or default for custom)
- `filterExercises(exercises, { muscleGroups, equipment })` - Filter array by criteria
- `searchExercises(exercises, query)` - Simple string search (case-insensitive, includes)
- `getRecentExercises(workouts, limit = 5)` - Get recently used exercises from workout history
- `toggleFavorite(exerciseName, favorites)` - Toggle favorite status, returns new Set

**Important:** This module should be pure data/utilities with no storage operations. Storage remains in data.js.
  </action>
  <verify>
File exists at js/data/exercises.js. Run `node -e "import('./js/data/exercises.js').then(m => console.log(Object.keys(m.EXERCISES).length))"` - should output 28 (number of default exercises).
  </verify>
  <done>
- EXERCISES object contains all 28 default exercises with metadata
- MUSCLE_GROUPS and EQUIPMENT_TYPES constants exported
- filterExercises, searchExercises, getRecentExercises, toggleFavorite functions exported
  </done>
</task>

<task type="auto">
  <name>Task 2: Update data.js to use exercise metadata</name>
  <files>js/data.js</files>
  <action>
Update js/data.js to integrate with the new exercise module:

1. Import exercise utilities:
```javascript
import { EXERCISES, getExerciseMetadata } from './data/exercises.js';
```

2. Replace DEFAULT_EXERCISES array with keys from EXERCISES:
```javascript
const DEFAULT_EXERCISES = Object.keys(EXERCISES).filter(name => EXERCISES[name].isDefault);
```

3. Update data structure to support:
   - `favorites: []` array in app data (list of exercise names)
   - Custom exercises now stored with metadata: `customExercises: { name: { primaryMuscles, secondaryMuscles, equipment, isCustom: true } }`

4. Update `addCustomExercise()` to accept metadata parameter:
```javascript
export async function addCustomExercise(data, exerciseName, metadata = {}) {
  const trimmed = exerciseName.trim();
  if (trimmed && !data.exerciseLibrary.includes(trimmed)) {
    data.exerciseLibrary.push(trimmed);
    data.exerciseLibrary.sort();
    // Store custom exercise metadata
    if (!data.customExercises) data.customExercises = {};
    data.customExercises[trimmed] = {
      primaryMuscles: metadata.primaryMuscles || ['Other'],
      secondaryMuscles: metadata.secondaryMuscles || [],
      equipment: metadata.equipment || 'Other',
      isCustom: true
    };
    await saveData(data);
  }
  return data;
}
```

5. Add `toggleFavoriteExercise()` function:
```javascript
export async function toggleFavoriteExercise(data, exerciseName) {
  if (!data.favorites) data.favorites = [];
  const index = data.favorites.indexOf(exerciseName);
  if (index >= 0) {
    data.favorites.splice(index, 1);
  } else {
    data.favorites.push(exerciseName);
  }
  await saveData(data);
  return data;
}
```

6. Update `getDefaultData()` to include favorites and customExercises.

**Important:** Maintain backward compatibility - existing data without these fields should still load correctly.
  </action>
  <verify>
Run `node -e "import('./js/data.js').then(m => console.log(typeof m.addCustomExercise, typeof m.toggleFavoriteExercise))"` - should output "function function".
  </verify>
  <done>
- data.js imports from exercises.js
- DEFAULT_EXERCISES derived from EXERCISES object
- addCustomExercise accepts metadata parameter
- toggleFavoriteExercise function exists
- Data structure supports favorites and customExercises
- Backward compatible with existing data
  </done>
</task>

<task type="auto">
  <name>Task 3: Update getMuscleGroupStats to use new metadata</name>
  <files>js/data.js</files>
  <action>
Update the `getMuscleGroupStats()` function to use the new exercise metadata instead of hardcoded muscle group mappings:

```javascript
import { EXERCISES, MUSCLE_GROUPS } from './data/exercises.js';

export function getMuscleGroupStats(data) {
  const stats = {};
  // Initialize all primary muscle groups from MUSCLE_GROUPS
  for (const group of Object.keys(MUSCLE_GROUPS)) {
    stats[group] = { sets: 0, volume: 0 };
  }
  stats['Other'] = { sets: 0, volume: 0 };

  for (const workout of data.workouts) {
    for (const exercise of workout.exercises) {
      // Get metadata from EXERCISES or customExercises
      const metadata = EXERCISES[exercise.name] ||
                       data.customExercises?.[exercise.name] ||
                       { primaryMuscles: ['Other'] };

      const primaryGroup = metadata.primaryMuscles[0] || 'Other';
      const targetGroup = stats[primaryGroup] ? primaryGroup : 'Other';

      stats[targetGroup].sets += exercise.sets.length;
      stats[targetGroup].volume += exercise.sets.reduce((sum, s) => sum + s.reps * s.weight, 0);
    }
  }

  return stats;
}
```

This makes the muscle group stats automatically work with custom exercises that have metadata.
  </action>
  <verify>
The function should still work the same as before for built-in exercises. Run app and check Progress > Muscle Groups section displays correctly.
  </verify>
  <done>
- getMuscleGroupStats uses EXERCISES and customExercises metadata
- Custom exercises with metadata show in correct muscle group
- Custom exercises without metadata show in "Other"
  </done>
</task>

</tasks>

<verification>
1. Module loads: `node -e "import('./js/data/exercises.js').then(m => console.log('Exercises:', Object.keys(m.EXERCISES).length))"`
2. Data integration: `node -e "import('./js/data.js').then(m => console.log('Functions:', Object.keys(m).filter(k => typeof m[k] === 'function').length))"`
3. App still works: Start app with `npm start`, navigate to Library view, verify exercises display
4. Filter works: In browser console, `import('./js/data/exercises.js').then(m => console.log(m.filterExercises(Object.keys(m.EXERCISES), {muscleGroups: ['Chest']})))`
</verification>

<success_criteria>
- js/data/exercises.js exists with 28+ exercises having metadata
- MUSCLE_GROUPS constant has 12+ primary groups with sub-groups
- EQUIPMENT_TYPES constant has 10 equipment types
- filterExercises returns correct exercises for muscle group filter
- searchExercises returns matching exercises for query
- App loads without errors
- Muscle group stats still work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-ux-overhaul-exercise-system/02-01-SUMMARY.md`
</output>
