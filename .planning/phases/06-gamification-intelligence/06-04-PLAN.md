---
phase: 06-gamification-intelligence
plan: 04
type: execute
---

<objective>
Build the intelligence engine: exercise recommendations, training split suggestions, balance alerts, recovery insights, and fatigue detection.

Purpose: This is the "smart coach" â€” the core value proposition that makes LagomStronk feel intelligent. Rule-based, deterministic, and explainable.
Output: Intelligence module with recommendation functions, integrated into workout flow and dashboard.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-gamification-intelligence/06-CONTEXT.md
@.planning/phases/06-gamification-intelligence/06-01-SUMMARY.md
@.planning/phases/06-gamification-intelligence/06-03-SUMMARY.md

# Key files:
@js/data.js
@js/app.js
@index.html
@css/style.css

**Tech stack available:** Chart.js, canvas-confetti, localStorage data layer
**Established patterns:**
- getProgressiveOverloadSuggestion() already exists (line 1403) â€” enhance, don't replace
- getMissedMuscleGroups() already exists (line 1536) â€” enhance for balance alerts
- getMuscleGroupStats() exists (line 837) â€” use for heatmap data
- getExerciseMetadata() provides muscle group mapping
- Coach hints render inline during workout (renderCoachHint, line 702)
- Muscle alert renders on dashboard (renderMuscleAlert, line 466)

**Constraining decisions:**
- Phase 6 CONTEXT: Intelligence must be rule-based and deterministic
- Phase 6 CONTEXT: Users should understand why app suggests something
- Phase 3: Progressive overload already suggests +2.5kg based on last 3 workouts
- Phase 6-01: userProfile provides goals, experience, equipment for personalization
</context>

<tasks>

<task type="auto">
  <name>Task 1: Intelligence engine data functions</name>
  <files>js/data.js</files>
  <action>
Add intelligence functions to data.js. These are all rule-based, deterministic, and explainable:

**1. getExerciseRecommendations(data)** â€” INTL-02
Returns top 5 exercise suggestions based on:
- Muscle groups that are undertrained (from getMissedMuscleGroups)
- User's available equipment (from userProfile.equipment)
- User's goals (strength â†’ compound lifts prioritized, hypertrophy â†’ isolation included)
- Exercises not recently performed (variety)
Return format: `[{exercise: 'Lat Pulldown', reason: 'Back undertrained (8 days)', priority: 'high'}]`

**2. getTrainingSplitSuggestion(data)** â€” INTL-03
Based on userProfile.trainingDays and experience:
- 3 days â†’ Full body or PPL compressed
- 4 days â†’ Upper/Lower split
- 5-6 days â†’ PPL or Push/Pull/Legs/Arms
Return: `{split: 'Push/Pull/Legs', schedule: [{day: 'Mon', focus: 'Push'}, ...], reason: '...'}`
Only suggest if no active program. If active program, return null.

**3. getRecoveryInsights(data)** â€” INTL-06
For each muscle group, calculate:
- Last trained date
- Estimated recovery status: 'recovered' (48h+), 'recovering' (24-48h), 'fresh' (<24h)
- Recommended: 'ready to train', 'rest recommended', 'train if feeling good'
Return: `[{muscle: 'Chest', lastTrained: '2026-02-07', hoursAgo: 48, status: 'recovered', recommendation: 'Ready to train'}]`

**4. getFatigueScore(data)** â€” INTL-10
Calculate weekly training load:
- Total sets this week vs average weekly sets (last 4 weeks)
- Total volume this week vs average weekly volume
- If current week > 130% of average â†’ 'high fatigue' warning
- If current week > 150% â†’ 'overtraining risk'
Return: `{score: 'moderate', setsThisWeek: 45, avgSets: 35, volumeRatio: 1.28, warning: null}`

**5. Enhanced getProgressiveOverloadSuggestion** â€” INTL-05
Enhance existing function to factor in userProfile.experience:
- Beginner: +2.5kg after 2 successful sessions
- Intermediate: +2.5kg after 3 successful sessions (current behavior)
- Advanced: +1.25kg after 3 successful sessions
Don't break existing API â€” add experience as optional consideration from userProfile.

**What to avoid:** Don't use AI/ML â€” all rules are explicit if/else logic. Don't import any new libraries. Don't replace existing functions â€” enhance them.
  </action>
  <verify>In console, test each function with sample data. Verify recommendations respect equipment filter. Verify recovery uses actual workout dates. Verify fatigue calculation is correct.</verify>
  <done>5 intelligence functions implemented, all rule-based, using userProfile for personalization, backward-compatible with existing progressive overload</done>
</task>

<task type="auto">
  <name>Task 2: Intelligence UI integration â€” dashboard and workout flow</name>
  <files>js/app.js, index.html, css/style.css</files>
  <action>
Integrate intelligence engine into the UI:

**Dashboard (Today view):**
- **Smart Coach Card:** Below the hero section, add a coach insights card that rotates between:
  - Exercise recommendations ("Try Lat Pulldown â€” back undertrained for 8 days")
  - Training split suggestion (if no active program)
  - Fatigue warning (if score is high)
  - Recovery status summary ("Chest and shoulders recovered, legs still recovering")
- Show 1-2 insights at a time, most relevant first (fatigue warnings > balance alerts > recommendations)
- Card style: subtle coach icon (ðŸ§ ), mint left border, brief text with "why" reason

**Workout Flow:**
- Enhance existing `renderCoachHint()` (line 702) to include recovery status for the current exercise's muscle group. E.g., "Last trained chest 3 days ago â€” recovered and ready" or "Trained yesterday â€” take it easy"
- Enhanced progressive overload hints now factor in experience level

**What to avoid:** Don't overwhelm the dashboard â€” max 2 insight cards visible. Don't show insights when there's insufficient data (<5 workouts). Don't make the coach card dismissible-forever (it should always show relevant insights). Don't add a separate "Intelligence" view/tab.
  </action>
  <verify>Open dashboard, verify coach insights card shows relevant recommendations. Start a workout, verify enhanced coach hints appear with recovery info. Verify no insights shown with <5 workouts.</verify>
  <done>Dashboard shows rotating coach insights (recommendations, split, fatigue, recovery). Workout flow shows enhanced hints with recovery status. Minimum data threshold enforced.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Intelligence engine with exercise recommendations, training splits, recovery insights, fatigue detection, and enhanced progressive overload â€” all integrated into dashboard and workout flow</what-built>
  <how-to-verify>
    1. Open the app with some workout history
    2. Check Today view for Smart Coach Card with insights
    3. Verify insights are relevant (e.g., recommends undertrained muscles)
    4. Verify fatigue warnings appear if training volume is high
    5. Start a workout, check enhanced coach hints with recovery info
    6. Verify minimum data threshold (try with fresh data)
    7. Check that recommendations respect equipment from user profile
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 intelligence functions return correct, explainable results
- [ ] Dashboard shows coach insights card with 1-2 relevant insights
- [ ] Workout flow shows recovery-aware coach hints
- [ ] Progressive overload considers experience level
- [ ] No insights shown with insufficient data
- [ ] Equipment filter works in recommendations
- [ ] No console errors
</verification>

<success_criteria>

- Rule-based intelligence engine with 5 functions covering INTL-02, 03, 04, 05, 06, 10
- Dashboard integration showing contextual coaching insights
- Workout flow enhanced with recovery-aware hints
- All recommendations explainable ("because X, we suggest Y")
- Minimum data threshold prevents empty/misleading insights
</success_criteria>

<output>
After completion, create `.planning/phases/06-gamification-intelligence/06-04-SUMMARY.md`
</output>
