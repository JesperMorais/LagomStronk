---
phase: 06-gamification-intelligence
plan: 02
type: execute
---

<objective>
Build gamification system with enhanced streak tracking (rest day logic), badge/achievement system, and streak milestone celebrations.

Purpose: Light gamification that builds habits without feeling like a game. Streak with rest day logic is the core engagement hook.
Output: Streak system with 5/week target, badge engine with milestone tracking, celebration animations for streaks.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-gamification-intelligence/06-CONTEXT.md
@.planning/phases/06-gamification-intelligence/06-01-SUMMARY.md

# Key files:
@js/data.js
@js/app.js
@index.html
@css/style.css

**Tech stack available:** Chart.js, canvas-confetti (already imported), localStorage data layer
**Established patterns:** Streak calculation exists in data.js (calculateStreaks, getFrequencyStats), confetti celebrations (03-04 PR celebration), hero section rendering
**Constraining decisions:**
- Phase 2: Streak display on dashboard hero (flame icon + 7-day calendar)
- Phase 3: canvas-confetti already integrated for PR celebrations
- Phase 6-01: userProfile.trainingDays provides target days/week
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhanced streak system with rest day logic and badges data model</name>
  <files>js/data.js</files>
  <action>
**Streak Enhancement:** Modify the existing `calculateStreaks()` function (line 706) to support rest-day-aware streaks. Current logic counts consecutive calendar days. New logic:

- A streak is maintained if the user trains at least `userProfile.trainingDays` times per week (default 5)
- A "rest day" doesn't break the streak ‚Äî only a missed training week does
- Calculate `weeklyStreak`: consecutive weeks where user met their training day target
- Keep existing `currentStreak` (daily) for backward compatibility but add `weeklyStreak` and `weeklyTarget` to frequency stats

**Badges/Achievements Data Model:** Add `achievements` to data model:
```
achievements: {
  earned: [],   // [{id: 'workout_10', earnedAt: '2026-02-09', seen: false}]
}
```

Define ACHIEVEMENT_DEFINITIONS constant (not in data, just exported const):
```
ACHIEVEMENT_DEFINITIONS = [
  {id: 'workout_10', name: 'Getting Started', desc: '10 workouts completed', icon: 'üí™', check: (data) => data.workouts.length >= 10},
  {id: 'workout_50', name: 'Committed', desc: '50 workouts completed', icon: 'üî•', check: (data) => data.workouts.length >= 50},
  {id: 'workout_100', name: 'Century', desc: '100 workouts completed', icon: 'üèÜ', check: (data) => data.workouts.length >= 100},
  {id: 'streak_7', name: 'Week Warrior', desc: '7-day streak', icon: '‚ö°', check: ...},
  {id: 'streak_30', name: 'Iron Will', desc: '30-day streak', icon: 'üåü', check: ...},
  {id: 'streak_weeks_4', name: 'Monthly Consistency', desc: '4-week streak hitting target', icon: 'üìÖ', check: ...},
  {id: 'pr_first', name: 'New Record', desc: 'First personal record', icon: 'üéØ', check: ...},
  {id: 'pr_10', name: 'Record Breaker', desc: '10 personal records', icon: 'üèÖ', check: ...},
  {id: 'exercises_10', name: 'Explorer', desc: '10 unique exercises used', icon: 'üß≠', check: ...},
  {id: 'volume_10k', name: 'Heavy Lifter', desc: '10,000 kg total volume', icon: 'ü™®', check: ...},
  {id: 'volume_100k', name: 'Monster', desc: '100,000 kg total volume', icon: 'üëπ', check: ...},
]
```

Add functions:
- `checkNewAchievements(data)` ‚Äî checks all definitions against data, returns newly earned (not already in earned list)
- `markAchievementSeen(data, achievementId)` ‚Äî marks as seen
- `getEarnedAchievements(data)` ‚Äî returns earned list with definition details

Ensure loadData() migrates missing `achievements` field.
  </action>
  <verify>In console, verify `loadData().achievements` exists. Call checkNewAchievements with test data to verify badge detection works.</verify>
  <done>Enhanced streak with rest day logic, achievement definitions, check/earn/seen functions, data migration for achievements field</done>
</task>

<task type="auto">
  <name>Task 2: Streak dashboard update and badge celebration UI</name>
  <files>js/app.js, index.html, css/style.css</files>
  <action>
**Dashboard Streak Enhancement:** Update `renderHero()` / `renderHeroStats()` to show the enhanced streak:
- Show weekly streak ("3 weeks consistent" or similar) alongside daily streak
- Use `userProfile.trainingDays` as the target in the 7-day calendar
- Color coding: green for training days that meet weekly target, amber if behind pace

**Achievement Checking:** After each workout save (when workout is completed/saved), call `checkNewAchievements(data)`. If new achievements earned:
- Show a celebration toast with the badge icon and name
- Use canvas-confetti (same as PR celebrations) but with different colors (gold tones)
- If it's a streak milestone (streak_7, streak_30, streak_weeks_4), show a larger celebration with confetti burst

**Badge Display:** Add a small badge count indicator to the Today view header (near the settings gear). Tapping it shows earned badges in a modal grid (3 columns, icon + name + desc). Unearned badges shown greyed out with "?" icon.

**What to avoid:** Don't create a separate nav tab for achievements ‚Äî keep it lightweight (modal from header). Don't make celebrations too long or intrusive (0.5s max). Don't show celebrations for badges earned retroactively on first load ‚Äî only celebrate new ones earned after a workout.
  </action>
  <verify>Complete a workout, verify achievement check runs. If milestones met, verify toast + confetti appears. Check badges modal shows earned/unearned correctly.</verify>
  <done>Dashboard shows enhanced streak with rest day logic, achievements check after workout completion, celebration animations for new achievements, badge grid modal accessible from header</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Enhanced streak shows weekly consistency, not just daily
- [ ] Achievement definitions cover all specified milestones
- [ ] New achievements trigger celebration after workout save
- [ ] Badge modal shows earned and unearned achievements
- [ ] Streak celebrations use confetti (same library, different style than PR)
- [ ] No console errors
</verification>

<success_criteria>

- Streak system accounts for rest days using training day target from profile
- 11+ achievement definitions covering workouts, streaks, PRs, volume
- Achievements earned and celebrated after workout completion
- Badge grid accessible from Today view header
- Celebrations are brief and non-intrusive
</success_criteria>

<output>
After completion, create `.planning/phases/06-gamification-intelligence/06-02-SUMMARY.md`
</output>
