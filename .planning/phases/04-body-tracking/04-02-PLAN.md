---
phase: 04-body-tracking
plan: 02
type: execute
---

<objective>
Add muscle measurement tracking and body fat % logging with individual trend charts for each measurement type.

Purpose: Complete the body tracking experience with comprehensive measurement logging for bicep, chest, waist, and thigh — each with its own trend chart — plus manual body fat percentage entry.
Output: Measurement entry form, 4 individual measurement trend charts, body fat entry with chart, all integrated into the Body tab.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-body-tracking/04-CONTEXT.md
@.planning/phases/04-body-tracking/04-01-SUMMARY.md

# Key files:
@js/data.js
@js/app.js
@js/charts.js
@index.html
@css/style.css

**Tech stack available:** Chart.js (CDN), localStorage via data.js
**Established patterns:**
- Body tracking data model from 04-01 (bodyTracking.weight, measurements, bodyFat)
- Weight chart pattern from 04-01 (updateWeightChart in charts.js)
- Body view rendering from 04-01 (renderBodyView in app.js)

**Constraining decisions:**
- [04-CONTEXT]: Individual charts for each measurement (NOT combined). Body fat is manual entry only. No estimation tools.
- [04-CONTEXT]: All four measurements matter: bicep, chest, waist, thigh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add measurement entry form and charts</name>
  <files>index.html, js/app.js, js/charts.js, css/style.css</files>
  <action>
**index.html changes — populate `#measurements-section`:**

Replace the measurements placeholder div with:
```html
<div class="stats-section">
    <h3 class="stats-section-title">Measurements</h3>

    <!-- Measurement Entry Form -->
    <div class="measurement-form card">
        <div class="measurement-inputs">
            <div class="body-input-row">
                <label>Bicep</label>
                <div class="body-input-group">
                    <input type="number" id="meas-bicep" step="0.1" placeholder="—" class="body-number-input measurement-input">
                    <span class="body-unit">cm</span>
                </div>
            </div>
            <div class="body-input-row">
                <label>Chest</label>
                <div class="body-input-group">
                    <input type="number" id="meas-chest" step="0.1" placeholder="—" class="body-number-input measurement-input">
                    <span class="body-unit">cm</span>
                </div>
            </div>
            <div class="body-input-row">
                <label>Waist</label>
                <div class="body-input-group">
                    <input type="number" id="meas-waist" step="0.1" placeholder="—" class="body-number-input measurement-input">
                    <span class="body-unit">cm</span>
                </div>
            </div>
            <div class="body-input-row">
                <label>Thigh</label>
                <div class="body-input-group">
                    <input type="number" id="meas-thigh" step="0.1" placeholder="—" class="body-number-input measurement-input">
                    <span class="body-unit">cm</span>
                </div>
            </div>
        </div>
        <button id="log-measurements-btn" class="btn-primary body-log-btn">Log Measurements</button>
        <p class="measurement-hint">Fill in any or all measurements</p>
    </div>

    <!-- Individual Measurement Charts -->
    <div class="measurement-charts">
        <div class="measurement-chart-card">
            <h4 class="measurement-chart-title">Bicep</h4>
            <div class="chart-container chart-container-sm">
                <canvas id="bicep-chart"></canvas>
            </div>
        </div>
        <div class="measurement-chart-card">
            <h4 class="measurement-chart-title">Chest</h4>
            <div class="chart-container chart-container-sm">
                <canvas id="chest-chart"></canvas>
            </div>
        </div>
        <div class="measurement-chart-card">
            <h4 class="measurement-chart-title">Waist</h4>
            <div class="chart-container chart-container-sm">
                <canvas id="waist-chart"></canvas>
            </div>
        </div>
        <div class="measurement-chart-card">
            <h4 class="measurement-chart-title">Thigh</h4>
            <div class="chart-container chart-container-sm">
                <canvas id="thigh-chart"></canvas>
            </div>
        </div>
    </div>
</div>
```

**js/app.js changes:**

1. Update `renderBodyView()` to also call `renderMeasurements()`.

2. Create `renderMeasurements()`:
   - For each measurement type (bicep, chest, waist, thigh), call `updateMeasurementChart(appData, type)` from charts.js
   - Show latest value for each measurement below the chart title (e.g., "Latest: 38.0 cm") with delta from previous

3. Setup event listener for `#log-measurements-btn`:
   - Read values from all 4 measurement inputs
   - At least 1 must be filled (validate — show feedback if all empty)
   - Values must be > 0 and < 300 (reasonable cm range)
   - Build measurements object with non-empty fields only (null for empty ones)
   - Call addMeasurementEntry(appData, todayStr, measurements, 'cm')
   - Call saveData(appData)
   - Clear inputs, re-render
   - Show "Logged!" feedback

**js/charts.js changes:**

1. Add chart instance tracking: `const measurementCharts = {}` to hold bicep/chest/waist/thigh chart instances.

2. Create `updateMeasurementChart(data, type)` function (exported):
   - Get history via getMeasurementHistory(data, type)
   - Destroy existing chart for this type if exists
   - Render Chart.js line chart on canvas `${type}-chart`
   - Use same mint gradient fill style as weight chart
   - Y-axis: measurement value in cm, NOT starting at zero (suggestedMin/Max from data range ± 2cm)
   - If < 2 data points, show empty state
   - Smaller chart height than weight chart (use `.chart-container-sm` CSS class)

3. Add measurement chart cleanup to destroyCharts().

**css/style.css changes:**

1. `.measurement-form` — Card styling matching body-quick-log
2. `.measurement-inputs` — Grid or stack of input rows
3. `.measurement-hint` — Small muted text below button
4. `.measurement-charts` — Container for the 4 chart cards
5. `.measurement-chart-card` — Individual chart card with subtle border/bg
6. `.measurement-chart-title` — Small title above each chart
7. `.chart-container-sm` — Smaller chart container (height: ~150px vs default)
  </action>
  <verify>Open Body tab. Scroll to measurements section. Fill in 2 of 4 measurements and log. Charts for those 2 types should render. Empty charts show placeholder for the others.</verify>
  <done>All 4 measurement inputs work. Log button saves with partial data (any combo of bicep/chest/waist/thigh). Individual trend charts render per measurement type. Charts show data range, not zero-based.</done>
</task>

<task type="auto">
  <name>Task 2: Add body fat % entry and chart</name>
  <files>index.html, js/app.js, js/charts.js, css/style.css</files>
  <action>
**index.html changes — populate `#bodyfat-section`:**

Replace the body fat placeholder div with:
```html
<div class="stats-section">
    <h3 class="stats-section-title">Body Composition</h3>

    <div class="bodyfat-form card">
        <div class="body-input-row">
            <label>Body Fat</label>
            <div class="body-input-group">
                <input type="number" id="bodyfat-input" step="0.1" placeholder="0.0" class="body-number-input">
                <span class="body-unit">%</span>
            </div>
        </div>
        <button id="log-bodyfat-btn" class="btn-primary body-log-btn">Log Body Fat</button>
    </div>

    <!-- Body Fat Chart -->
    <div class="chart-container chart-container-sm">
        <canvas id="bodyfat-chart"></canvas>
    </div>
</div>
```

**js/app.js changes:**

1. Update `renderBodyView()` to also call `renderBodyFat()`.

2. Create `renderBodyFat()`:
   - Call `updateBodyFatChart(appData)` from charts.js
   - Show latest body fat % with delta from previous entry

3. Setup event listener for `#log-bodyfat-btn`:
   - Read value from `#bodyfat-input`
   - Validate: must be > 0 and < 60 (reasonable body fat % range)
   - Call addBodyFatEntry(appData, todayStr, value)
   - Call saveData(appData)
   - Clear input, re-render
   - Show "Logged!" feedback

**js/charts.js changes:**

1. Add `let bodyFatChart = null;` at top.

2. Create `updateBodyFatChart(data)` function (exported):
   - Get history via getBodyFatHistory(data)
   - Line chart with same mint gradient style
   - Y-axis: percentage, suggestedMin/Max from data range ± 2%
   - Use `.chart-container-sm` for smaller size

3. Add bodyFatChart cleanup to destroyCharts().

**css changes:** Minimal — `.bodyfat-form` uses existing card + body-input-row patterns.
  </action>
  <verify>Open Body tab, scroll to Body Composition section. Log a body fat %. Chart renders. Log a second entry — chart shows trend line between points.</verify>
  <done>Body fat % input with validation (0-60 range). Body fat trend chart renders. Latest value displayed with delta. Data persists across reloads.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete body tracking experience: weight + measurements + body fat</what-built>
  <how-to-verify>
    1. Open app in browser
    2. Navigate to Body tab
    3. Weight section (from 04-01) should still work
    4. Scroll to Measurements section — 4 input fields visible (bicep, chest, waist, thigh)
    5. Fill in bicep (38) and chest (105) only, tap Log — should accept partial data
    6. Charts for bicep and chest should show data points; waist/thigh charts show empty state
    7. Log another set of measurements with all 4 filled
    8. All 4 charts should now render
    9. Scroll to Body Composition — enter body fat (15.2%), tap Log
    10. Body fat chart should render
    11. Reload page — all data should persist
    12. Check mobile viewport (375px) — all sections should stack nicely
    13. Verify all existing tabs (Today, Plans, History, Stats, Library) still function
  </how-to-verify>
  <resume-signal>Type "approved" to continue to next phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 4 measurement charts render independently
- [ ] Body fat chart renders
- [ ] Partial measurement logging works (any combo of 4 fields)
- [ ] Data persists across reloads
- [ ] No console errors
- [ ] Mobile layout works without horizontal scroll
- [ ] Existing features unaffected
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- BODY-01 (weight chart) — complete from 04-01
- BODY-02 (muscle measurements with history) — complete
- BODY-03 (measurement trend charts) — complete
- BODY-06 (body fat % manual entry) — complete
- BODY-04, BODY-05 (progress photos) — deferred per CONTEXT.md
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-body-tracking/04-02-SUMMARY.md`
</output>
