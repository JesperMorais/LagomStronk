---
phase: 04-body-tracking
plan: 01
type: execute
---

<objective>
Add body tracking data model and weight tracking with trend chart as the hero feature of a new Body tab.

Purpose: Establish the data infrastructure for all body tracking and deliver the primary user experience ‚Äî logging weight and seeing the trend over time.
Output: New "Body" bottom nav tab with weight entry form, weight history list, and weight trend chart using Chart.js.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/04-body-tracking/04-CONTEXT.md

# Key files:
@js/data.js
@js/app.js
@js/charts.js
@index.html
@css/style.css

**Tech stack available:** Chart.js (CDN), localStorage via data.js loadData/saveData pattern
**Established patterns:**
- Views as `<section id="X-view" class="view">` toggled via switchView()
- Navigation via `.nav-btn[data-view]` in `.bottom-nav`
- Data stored in single `lagomstronk_data` localStorage object via loadData()/saveData()
- Charts via Chart.js with mint (#D1FFC6) theme and dark background
- getChartOptions() helper in charts.js for consistent styling

**Constraining decisions:**
- [Phase 1]: All data in localStorage via loadData/saveData
- [Phase 2]: Mint (#D1FFC6) primary color, dark (#0f1419) background
- [04-CONTEXT]: Progress photos deferred. No health sync. No logging reminders. Body fat % is manual entry only.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add body tracking data model to data.js</name>
  <files>js/data.js</files>
  <action>
Add body tracking data structures and helper functions to data.js:

1. **Data shape** ‚Äî Add to getDefaultData() return object:
   ```
   bodyTracking: {
     weight: [],        // [{date: "2026-02-06", value: 85.5, unit: "kg"}]
     measurements: [],  // [{date: "2026-02-06", bicep: 38, chest: 105, waist: 82, thigh: 60, unit: "cm"}]
     bodyFat: []        // [{date: "2026-02-06", value: 15.2}]
   }
   ```

2. **Migration guard in loadData()** ‚Äî Add `if (!data.bodyTracking)` block that initializes `data.bodyTracking = { weight: [], measurements: [], bodyFat: [] }` (same pattern as existing exerciseLibrary/workoutTemplates guards).

3. **CRUD helper functions** (exported):
   - `addWeightEntry(data, date, value, unit)` ‚Äî Push entry to data.bodyTracking.weight, sort by date descending. If entry for same date exists, update it.
   - `getWeightHistory(data, limit)` ‚Äî Return weight entries sorted by date ascending (for chart). Optional limit param.
   - `getLatestWeight(data)` ‚Äî Return most recent weight entry or null.
   - `addMeasurementEntry(data, date, measurements, unit)` ‚Äî Push to data.bodyTracking.measurements. measurements is {bicep, chest, waist, thigh} (all numbers, any can be null). Same-date update logic.
   - `getMeasurementHistory(data, type)` ‚Äî Return entries for a specific measurement type (e.g., 'bicep'), filtered to entries where that field is non-null, sorted ascending by date.
   - `addBodyFatEntry(data, date, value)` ‚Äî Push to data.bodyTracking.bodyFat. Same-date update.
   - `getBodyFatHistory(data)` ‚Äî Return body fat entries sorted ascending by date.

Date format: ISO "YYYY-MM-DD" strings (consistent with workout dates).
  </action>
  <verify>Grep data.js for "bodyTracking" ‚Äî should find data structure, migration guard, and all 7 helper functions. No syntax errors (open browser console).</verify>
  <done>bodyTracking data model exists in getDefaultData(), loadData() handles missing data gracefully, all 7 CRUD functions exported and callable.</done>
</task>

<task type="auto">
  <name>Task 2: Add Body nav tab and weight tracking UI</name>
  <files>index.html, js/app.js, js/charts.js, css/style.css</files>
  <action>
**index.html changes:**

1. Add new nav button in `.bottom-nav` between Stats and Library:
   ```html
   <button class="nav-btn" data-view="body">
       <span class="nav-icon">üìè</span>
       <span class="nav-label">Body</span>
   </button>
   ```

2. Add new view section (before library-view):
   ```html
   <section id="body-view" class="view">
       <div class="view-header">
           <h2>Body Tracking</h2>
       </div>

       <!-- Quick Log Card -->
       <div class="body-quick-log card">
           <div class="body-current-stats" id="body-current-stats">
               <!-- Current weight + change rendered here -->
           </div>
           <div class="body-log-form">
               <div class="body-input-row">
                   <label>Weight</label>
                   <div class="body-input-group">
                       <input type="number" id="weight-input" step="0.1" placeholder="0.0" class="body-number-input">
                       <span class="body-unit">kg</span>
                   </div>
               </div>
               <button id="log-weight-btn" class="btn-primary body-log-btn">Log Weight</button>
           </div>
       </div>

       <!-- Weight Trend Chart -->
       <div class="stats-section">
           <h3 class="stats-section-title">Weight Trend</h3>
           <div class="chart-container">
               <canvas id="weight-chart"></canvas>
           </div>
       </div>

       <!-- Weight History -->
       <div class="stats-section">
           <h3 class="stats-section-title">Recent Entries</h3>
           <div id="weight-history" class="weight-history-list">
               <!-- Weight entries rendered here -->
           </div>
       </div>

       <!-- Measurements Section (placeholder for 04-02) -->
       <div id="measurements-section"></div>

       <!-- Body Fat Section (placeholder for 04-02) -->
       <div id="bodyfat-section"></div>
   </section>
   ```

**js/app.js changes:**

1. Add `body: document.getElementById('body-view')` to the `views` object.

2. Add `case 'body': renderBodyView(); break;` to the switchView() switch statement.

3. Create `renderBodyView()` function:
   - Call `renderCurrentWeight()` to show latest weight + delta from previous
   - Call `updateWeightChart(appData)` from charts.js
   - Call `renderWeightHistory()` to show last 10 entries

4. Create `renderCurrentWeight()`:
   - Get latest weight entry via getLatestWeight()
   - If exists: show large weight number + date, calculate delta from previous entry (green arrow up/down with +/- kg)
   - If no entries: show "No weight logged yet" empty state

5. Create `renderWeightHistory()`:
   - Show last 10 weight entries in a simple list
   - Each row: date (formatted) | weight kg | delta from previous
   - Delta shown as colored +/- (green for loss if user trends down, neutral otherwise ‚Äî keep it simple, just show raw +/-)
   - Include delete button (X) on each entry with swipe-to-delete or simple click

6. Setup event listener for `#log-weight-btn`:
   - Read value from `#weight-input`
   - Validate: must be > 0 and < 500
   - Call addWeightEntry(appData, todayStr, value, 'kg')
   - Call saveData(appData)
   - Clear input, re-render body view
   - Show brief "Logged!" feedback (reuse toast pattern or simple flash)

**js/charts.js changes:**

1. Add `let weightChart = null;` at top with other chart vars.

2. Create `updateWeightChart(data)` function (exported):
   - Get weight history via getWeightHistory(data)
   - Use Chart.js line chart with mint gradient fill (same style as progress chart)
   - X-axis: dates, Y-axis: weight in kg
   - If < 2 data points, show encouraging empty state message
   - Include point styling matching existing charts (pointBackgroundColor: '#D1FFC6', etc.)
   - Y-axis should NOT start at zero (use suggestedMin/Max based on data range ¬± 5kg for better visibility of changes)

3. Add weightChart cleanup to `destroyCharts()`.

**css/style.css changes:**

1. Bottom nav: With 6 tabs, ensure `.nav-btn` sizing accommodates all tabs. Use `flex: 1` (should already work) but verify font-size and icon size don't overflow. May need to reduce `.nav-label` font-size to 9px for 6 tabs.

2. Body view styles:
   - `.body-quick-log` ‚Äî Card with padding, dark bg, rounded corners matching existing cards
   - `.body-current-stats` ‚Äî Large weight display (font-size: 2.5rem, color: white), delta below (font-size: 0.9rem, mint/red based on direction)
   - `.body-input-row` ‚Äî Flex row with label, input group
   - `.body-number-input` ‚Äî Dark input matching existing numpad input styling
   - `.body-unit` ‚Äî Subdued unit label
   - `.body-log-btn` ‚Äî Mint primary button
   - `.weight-history-list` ‚Äî List items with subtle separators
   - `.weight-entry` ‚Äî Flex row: date | value | delta | delete-btn
  </action>
  <verify>Open app in browser, navigate to Body tab. Weight entry form visible. Log a weight, chart updates, history shows entry. Navigate away and back ‚Äî data persists.</verify>
  <done>Body tab accessible from bottom nav. Can log weight with validation. Weight trend chart renders with Chart.js mint theme. Recent entries list shows with delete capability. Current weight stat card shows latest + delta.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Body tracking tab with weight logging, trend chart, and entry history</what-built>
  <how-to-verify>
    1. Open app in browser (or `npx serve .` from project root)
    2. Bottom nav should show 6 tabs including "Body" (üìè)
    3. Tap Body tab ‚Äî should see weight entry form
    4. Log a weight (e.g., 85.0) ‚Äî should see "Logged!" feedback
    5. Log 2-3 more weights with different values ‚Äî chart should render trend line
    6. Weight history list should show entries with dates and deltas
    7. Current weight stat should show latest value with change indicator
    8. Delete a weight entry ‚Äî should update chart and history
    9. Navigate to other tabs and back ‚Äî data should persist
    10. Check on mobile viewport (375px) ‚Äî 6 nav tabs should fit without overflow
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Body tab renders without console errors
- [ ] Weight data persists across page reloads
- [ ] Chart renders correctly with 0, 1, 2, and 5+ data points
- [ ] Bottom nav accommodates 6 tabs on mobile viewport
- [ ] Existing views (Today, Plans, History, Stats, Library) still work correctly
</verification>

<success_criteria>

- Body tracking data model in data.js with all CRUD functions
- New Body nav tab in bottom navigation
- Weight entry form with validation
- Weight trend chart with mint theme
- Weight history list with delete
- Current weight + delta display
- No regressions to existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/04-body-tracking/04-01-SUMMARY.md`
</output>
